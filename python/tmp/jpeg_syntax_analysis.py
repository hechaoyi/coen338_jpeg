def word(i, n=2):
    return int.from_bytes(b[i:i + n], 'big')


# https://en.wikipedia.org/wiki/JPEG#Syntax_and_structure
# b = open('./UNADJUSTEDNONRAW_thumb_7eb.jpg', 'rb').read()
b = open('Lenna.jpg', 'rb').read()
i, n = 0, len(b)
while i < n - 1:
    c = word(i)
    if c == 0xffd8:
        print(f'{i}. Start Of Image')
    elif c & 0xfff0 == 0xffe0:
        length = word(i + 2)
        print(f'{i}. APP{c & 0x0f} - {length - 2}: {b[i + 4:i + 2 + length]}')
        i += length
    elif c & 0xfff0 == 0xfffe:
        length = word(i + 2)
        print(f'{i}. Comment - {length - 2}: {b[i + 4:i + 2 + length]}')
        i += length
    elif c == 0xffc0:
        length = word(i + 2)
        print(f'{i}. Start Of Frame {word(i + 7)}x{word(i + 5)}x{word(i + 9, 1)} - {length - 2}: {b[i + 4:i + 2 + length]}')
        i += length
    elif c == 0xffc4:
        length = word(i + 2)
        print(f'{i}. Define Huffman Table - {length - 2}: {b[i + 4:i + 2 + length]}')
        i += length
    elif c == 0xffdb:
        length = word(i + 2)
        print(f'{i}. Define Quantization Table - {length - 2}: {b[i + 4:i + 2 + length]}')
        i += length
    elif c == 0xffdd:
        print(f'{i}. Define Restart Interval {word(i + 2, 4)}')
        i += 4
    elif c == 0xffda:
        for j in range(i + 2, n - 1):
            if b[j] == 0xff and b[j + 1] != 0x00:
                break
        length = j - i - 2
        print(f'{i}. Start Of Scan - {length}')
        i += length
    elif c & 0xfff8 == 0xffd0:
        for j in range(i + 2, n - 1):
            if b[j] == 0xff and b[j + 1] != 0x00:
                break
        length = j - i - 2
        print(f'{i}. Restart{c & 0x07} Of Scan - {length}')
        i += length
    elif c == 0xffd9:
        print(f'{i}. End Of Image')
    else:
        assert 0, f'{i}. {b[i:i + 2]}'
    i += 2
assert i == n

'''
0. Start Of Image
2. APP0 - 14: b'JFIF\x00\x01\x01\x00\x00H\x00H\x00\x00'
20. APP1 - 126: b'Exif\x00\x00MM\x00*\x00\x00\x00\x08\x00\x05\x01\x12\x00\x03\x00\x00\x00\x01\x00\x01\x00\x00\x01\x1a\x00\x05\x00\x00\x00\x01\x00\x00\x00J\x01\x1b\x00\x05\x00\x00\x00\x01\x00\x00\x00R\x01(\x00\x03\x00\x00\x00\x01\x00\x02\x00\x00\x87i\x00\x04\x00\x00\x00\x01\x00\x00\x00Z\x00\x00\x00\x00\x00\x00\x00H\x00\x00\x00\x01\x00\x00\x00H\x00\x00\x00\x01\x00\x02\xa0\x02\x00\x04\x00\x00\x00\x01\x00\x00\x02\x99\xa0\x03\x00\x04\x00\x00\x00\x01\x00\x00\x04\x9e\x00\x00\x00\x00'
150. APP13 - 54: b'Photoshop 3.0\x008BIM\x04\x04\x00\x00\x00\x00\x00\x008BIM\x04%\x00\x00\x00\x00\x00\x10\xd4\x1d\x8c\xd9\x8f\x00\xb2\x04\xe9\x80\t\x98\xec\xf8B~'
208. APP2 - 562: b'ICC_PROFILE\x00\x01\x01\x00\x00\x02$appl\x04\x00\x00\x00mntrRGB XYZ \x07\xe1\x00\x07\x00\x07\x00\r\x00\x16\x00 acspAPPL\x00\x00\x00\x00APPL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xf6\xd6\x00\x01\x00\x00\x00\x00\xd3-appl\xca\x1a\x95\x82%\x7f\x10M8\x99\x13\xd5\xd1\xea\x15\x82\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\ndesc\x00\x00\x00\xfc\x00\x00\x00ecprt\x00\x00\x01d\x00\x00\x00#wtpt\x00\x00\x01\x88\x00\x00\x00\x14rXYZ\x00\x00\x01\x9c\x00\x00\x00\x14gXYZ\x00\x00\x01\xb0\x00\x00\x00\x14bXYZ\x00\x00\x01\xc4\x00\x00\x00\x14rTRC\x00\x00\x01\xd8\x00\x00\x00 chad\x00\x00\x01\xf8\x00\x00\x00,bTRC\x00\x00\x01\xd8\x00\x00\x00 gTRC\x00\x00\x01\xd8\x00\x00\x00 desc\x00\x00\x00\x00\x00\x00\x00\x0bDisplay P3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00text\x00\x00\x00\x00Copyright Apple Inc., 2017\x00\x00XYZ \x00\x00\x00\x00\x00\x00\xf3Q\x00\x01\x00\x00\x00\x01\x16\xccXYZ \x00\x00\x00\x00\x00\x00\x83\xdf\x00\x00=\xbf\xff\xff\xff\xbbXYZ \x00\x00\x00\x00\x00\x00J\xbf\x00\x00\xb17\x00\x00\n\xb9XYZ \x00\x00\x00\x00\x00\x00(8\x00\x00\x11\x0b\x00\x00\xc8\xb9para\x00\x00\x00\x00\x00\x03\x00\x00\x00\x02ff\x00\x00\xf2\xa7\x00\x00\rY\x00\x00\x13\xd0\x00\x00\n[sf32\x00\x00\x00\x00\x00\x01\x0cB\x00\x00\x05\xde\xff\xff\xf3&\x00\x00\x07\x93\x00\x00\xfd\x90\xff\xff\xfb\xa2\xff\xff\xfd\xa3\x00\x00\x03\xdc\x00\x00\xc0n'
774. Start Of Frame 665x1182x3 - 15: b'\x08\x04\x9e\x02\x99\x03\x01"\x00\x02\x11\x01\x03\x11\x01'
793. Define Huffman Table - 29: b'\x00\x00\x01\x05\x01\x01\x01\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b'
826. Define Huffman Table - 179: b'\x10\x00\x02\x01\x03\x03\x02\x04\x03\x05\x05\x04\x04\x00\x00\x01}\x01\x02\x03\x00\x04\x11\x05\x12!1A\x06\x13Qa\x07"q\x142\x81\x91\xa1\x08#B\xb1\xc1\x15R\xd1\xf0$3br\x82\t\n\x16\x17\x18\x19\x1a%&\'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\x83\x84\x85\x86\x87\x88\x89\x8a\x92\x93\x94\x95\x96\x97\x98\x99\x9a\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa'
1009. Define Huffman Table - 29: b'\x01\x00\x03\x01\x01\x01\x01\x01\x01\x01\x01\x01\x00\x00\x00\x00\x00\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b'
1042. Define Huffman Table - 179: b'\x11\x00\x02\x01\x02\x04\x04\x03\x04\x07\x05\x04\x04\x00\x01\x02w\x00\x01\x02\x03\x11\x04\x05!1\x06\x12AQ\x07aq\x13"2\x81\x08\x14B\x91\xa1\xb1\xc1\t#3R\xf0\x15br\xd1\n\x16$4\xe1%\xf1\x17\x18\x19\x1a&\'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x92\x93\x94\x95\x96\x97\x98\x99\x9a\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa'
1225. Define Quantization Table - 65: b'\x00\x02\x02\x02\x02\x02\x02\x03\x02\x02\x03\x04\x03\x03\x03\x04\x05\x04\x04\x04\x04\x05\x07\x05\x05\x05\x05\x05\x07\x08\x07\x07\x07\x07\x07\x07\x08\x08\x08\x08\x08\x08\x08\x08\n\n\n\n\n\n\x0b\x0b\x0b\x0b\x0b\r\r\r\r\r\r\r\r\r\r'
1294. Define Quantization Table - 65: b'\x01\x02\x02\x02\x03\x03\x03\x06\x03\x03\x06\r\t\x07\t\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r'
1363. Define Restart Interval 262186
1369. Start Of Scan - 1898
3269. Restart0 Of Scan - 1911
5182. Restart1 Of Scan - 170
5354. Restart2 Of Scan - 170
5526. Restart3 Of Scan - 170
5698. Restart4 Of Scan - 170
5870. Restart5 Of Scan - 481
6353. Restart6 Of Scan - 684
7039. Restart7 Of Scan - 574
7615. Restart0 Of Scan - 353
7970. Restart1 Of Scan - 226
8198. Restart2 Of Scan - 1315
9515. Restart3 Of Scan - 878
10395. Restart4 Of Scan - 170
10567. Restart5 Of Scan - 170
10739. Restart6 Of Scan - 170
10911. Restart7 Of Scan - 170
11083. Restart0 Of Scan - 170
11255. Restart1 Of Scan - 170
11427. Restart2 Of Scan - 266
11695. Restart3 Of Scan - 2387
14084. Restart4 Of Scan - 1970
16056. Restart5 Of Scan - 2200
18258. Restart6 Of Scan - 1713
19973. Restart7 Of Scan - 170
20145. Restart0 Of Scan - 170
20317. Restart1 Of Scan - 170
20489. Restart2 Of Scan - 170
20661. Restart3 Of Scan - 170
20833. Restart4 Of Scan - 170
21005. Restart5 Of Scan - 170
21177. Restart6 Of Scan - 170
21349. Restart7 Of Scan - 445
21796. Restart0 Of Scan - 768
22566. Restart1 Of Scan - 259
22827. Restart2 Of Scan - 170
22999. Restart3 Of Scan - 170
23171. Restart4 Of Scan - 714
23887. Restart5 Of Scan - 883
24772. Restart6 Of Scan - 954
25728. Restart7 Of Scan - 762
26492. Restart0 Of Scan - 767
27261. Restart1 Of Scan - 828
28091. Restart2 Of Scan - 170
28263. Restart3 Of Scan - 1066
29331. Restart4 Of Scan - 1495
30828. Restart5 Of Scan - 628
31458. Restart6 Of Scan - 170
31630. Restart7 Of Scan - 170
31802. Restart0 Of Scan - 170
31974. Restart1 Of Scan - 170
32146. Restart2 Of Scan - 170
32318. Restart3 Of Scan - 170
32490. Restart4 Of Scan - 170
32662. Restart5 Of Scan - 170
32834. Restart6 Of Scan - 170
33006. Restart7 Of Scan - 170
33178. Restart0 Of Scan - 170
33350. Restart1 Of Scan - 170
33522. Restart2 Of Scan - 170
33694. Restart3 Of Scan - 1312
35008. Restart4 Of Scan - 758
35768. Restart5 Of Scan - 921
36691. Restart6 Of Scan - 1303
37996. Restart7 Of Scan - 170
38168. Restart0 Of Scan - 170
38340. Restart1 Of Scan - 170
38512. Restart2 Of Scan - 170
38684. Restart3 Of Scan - 170
38856. Restart4 Of Scan - 170
39028. Restart5 Of Scan - 170
39200. Restart6 Of Scan - 170
39372. Restart7 Of Scan - 170
39544. Restart0 Of Scan - 170
39716. End Of Image
'''
